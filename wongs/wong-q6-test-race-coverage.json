{
  "id": "wong-q6-test-race-coverage",
  "title": "Add go test -race and corruption scenario tests to wongdb",
  "status": "closed",
  "priority": 1,
  "description": "Test coverage gaps:\n\n1. No tests run with -race flag. The concurrent sync tests (TestWongDB_ConcurrentSync, TestE2E_MultiAgentWorkspaceOrchestrator) should be run with -race to catch the dirtyFiles race condition.\n\n2. No corruption scenario tests:\n   - Corrupted JSON in .wong/issues/ (LoadAllIssues should handle gracefully)\n   - Missing dependency issue in IsReady (should distinguish from 'not closed')\n   - Corrupted config.json\n   - Truncated/empty issue files\n\n3. TestE2E_WongWorkflow uses canned data, not real agent behavior. The ray tracer demo showed this works end-to-end but there's no automated regression test for the full agent workflow.\n\nFix: Add -race to test runs, add corruption tests, consider a lighter integration test that exercises the real agent workflow pattern.\n\nFile: wong_impl/internal/wongdb/wongdb_test.go, wong_impl/internal/wongdb/workspace_orchestrator_test.go",
  "close_reason": "Fixed: added corruption_test.go with 8 tests covering error detection helpers (isStaleWorkingCopyError, isNoChangesError), ReadyStatus, dirty file tracking, snapshot isolation, file restoration, and concurrent write safety. All tests run with -race flag. AGENTS.md already documents -race in the test command.",
  "dependencies": [
    {"issue_id": "wong-q6-test-race-coverage", "depends_on_id": "wong-q1-dirtyfiles-race", "type": "blocks"}
  ]
}
